        IDENTIFICATION DIVISION.
        PROGRAM-ID. EMPLOYEE-DAL-DB.

        ENVIRONMENT DIVISION.
        CONFIGURATION SECTION.
        REPOSITORY.
            FUNCTION ALL INTRINSIC.

        DATA DIVISION.
        WORKING-STORAGE SECTION.
        EXEC SQL
            INCLUDE SQLCA
        END-EXEC.
       01  WS-CONNECTED           PIC X VALUE 'N'.
       01  WS-CURSOR-OPEN         PIC X VALUE 'N'.
       01  LK-OPERATION           PIC X(4).

        LINKAGE SECTION.
       01  END-OF-FILE            PIC X.
       01  EMPLOYEE.
           05 EMP-ID              PIC 9(4).
           05 EMP-NAME            PIC A(30).
           05 SALARY-BRUT         PIC 9(6)V99.
           05 SALARY-NET          PIC 9(6)V99.

        PROCEDURE DIVISION USING LK-OPERATION END-OF-FILE EMPLOYEE.
        MAIN-LOGIC.
            EVALUATE LK-OPERATION
                WHEN 'READ'
                    PERFORM DAL-READ
                WHEN 'SAVE'
                    PERFORM DAL-SAVE
                WHEN 'END '
                    PERFORM DAL-END
            END-EVALUATE
            GOBACK.

        DAL-READ.
            IF WS-CONNECTED = 'N'
                EXEC SQL
                    CONNECT TO 'postgres'
                END-EXEC
                IF SQLCODE NOT = 0
                    MOVE 'Y' TO END-OF-FILE
                    EXIT PARAGRAPH
                END-IF
                MOVE 'Y' TO WS-CONNECTED
            END-IF

            IF WS-CURSOR-OPEN = 'N'
                EXEC SQL
                    DECLARE C_EMP CURSOR FOR
                    SELECT EMP_ID, EMP_NAME, SALARY_BRUT, SALARY_NET
                    FROM EMPLOYEE
                END-EXEC
                EXEC SQL
                    OPEN C_EMP
                END-EXEC
                IF SQLCODE NOT = 0
                    MOVE 'Y' TO END-OF-FILE
                    EXIT PARAGRAPH
                END-IF
                MOVE 'Y' TO WS-CURSOR-OPEN
            END-IF

            EXEC SQL
                FETCH C_EMP INTO
                    :EMP-ID,
                    :EMP-NAME,
                    :SALARY-BRUT,
                    :SALARY-NET
            END-EXEC
            IF SQLCODE NOT = 0
                MOVE 'Y' TO END-OF-FILE
            END-IF.

        DAL-SAVE.
            EXEC SQL
                UPDATE EMPLOYEE
                SET SALARY_NET = :SALARY-NET
                WHERE EMP_ID = :EMP-ID
            END-EXEC.

        DAL-END.
            IF WS-CURSOR-OPEN = 'Y'
                EXEC SQL
                    CLOSE C_EMP
                END-EXEC
                MOVE 'N' TO WS-CURSOR-OPEN
            END-IF

            IF WS-CONNECTED = 'Y'
                EXEC SQL
                    COMMIT
                END-EXEC
                EXEC SQL
                    DISCONNECT ALL
                END-EXEC
                MOVE 'N' TO WS-CONNECTED
            END-IF.