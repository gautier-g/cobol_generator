IDENTIFICATION DIVISION.
PROGRAM-ID. ANTENNE-LOGIC.
ENVIRONMENT DIVISION.
CONFIGURATION SECTION.
SOURCE-COMPUTER. GnuCOBOL.
OBJECT-COMPUTER. GnuCOBOL.
DATA DIVISION.
WORKING-STORAGE SECTION.
01  END-OF-FILE            PIC X.
77  OPERATION              PIC X(4).
77  WS-COUNT-TOTAL         PIC 9(6).
77  WS-COUNT-ERROR         PIC 9(6).
01  ANTENNE.
    05 ANTENNE-ID          PIC 9(9).
    05 ANTENNE-NOM         PIC X(50).
    05 ANTENNE-REGION      PIC X(50).
PROCEDURE DIVISION.
MAIN-PROCESS.
    DISPLAY '=========================================='
    DISPLAY 'DEBUT TRAITEMENT BATCH ANTENNES'
    DISPLAY '=========================================='
    INITIALIZE WS-COUNT-TOTAL WS-COUNT-ERROR
    MOVE 'N' TO END-OF-FILE
    MOVE 'READ' TO OPERATION
    CALL 'ANTENNE-DAL-DB' USING OPERATION END-OF-FILE ANTENNE
    PERFORM UNTIL END-OF-FILE = 'Y'
        ADD 1 TO WS-COUNT-TOTAL
        PERFORM NORMALIZE-REGION
        MOVE 'SAVE' TO OPERATION
        CALL 'ANTENNE-DAL-DB' USING OPERATION END-OF-FILE ANTENNE
        CALL 'ANTENNE-BUSINESS' USING ANTENNE
        MOVE 'READ' TO OPERATION
        CALL 'ANTENNE-DAL-DB' USING OPERATION END-OF-FILE ANTENNE
    END-PERFORM
    MOVE 'END ' TO OPERATION
    CALL 'ANTENNE-DAL-DB' USING OPERATION END-OF-FILE ANTENNE
    DISPLAY '=========================================='
    DISPLAY 'FIN TRAITEMENT BATCH ANTENNES'
    DISPLAY 'Nombre antennes traitees: ' WS-COUNT-TOTAL
    DISPLAY 'Antennes en erreur: ' WS-COUNT-ERROR
    DISPLAY '=========================================='
    STOP RUN
    .
NORMALIZE-REGION.
    IF ANTENNE-REGION OF ANTENNE = SPACES
        MOVE 'INCONNUE' TO ANTENNE-REGION OF ANTENNE
        ADD 1 TO WS-COUNT-ERROR
        DISPLAY 'ANOMALIE: Region antenne invalide'
    END-IF
    .